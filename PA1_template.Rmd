---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document:
    keep_md: true
---

## Loading and preprocessing the data

This chunk is for loading the data, and some useful libraries. I hide the results because there is a lot of text generated by charging the libraries and there is no real output that worth looking at.

```{r, results='hide', message=FALSE}
activity <- read.csv("activity.csv")
library(dplyr)
library(lubridate)
library(ggplot2)
activity$date <-ymd(activity$date) 
activity <- as_tibble(activity)
```

## What is mean total number of steps taken per day?

processing the data

```{r}
stepsxday <- activity %>% 
    group_by(date) %>% 
    summarise(total_steps = sum(steps, na.rm=T))
```

Presenting the data as histogram

```{r, dev='svg'}
stepsxday %>% 
    ggplot(aes(total_steps))+
    geom_histogram(fill="steelblue")+
    labs(title = "HISTOGRAM OF STEPS PER DAY", x = "Steps per day", y = "number of days" ,subtitle = "Number of days that the subject walk a determined number of steps \nMean ploted as a red line and Median as a green line.")+
    geom_vline(xintercept =mean(stepsxday$total_steps), colour="red")+
    geom_vline(xintercept = median(stepsxday$total_steps),  colour="green")
```

this code gets the mean and the median of total steps per day

```{r}
mean_stp <- mean(stepsxday$total_steps, na.rm=T)
median_stp <- median(stepsxday$total_steps, na.rm=T)
```

the mean steps per day is `r mean_stp` and the median value is equal to `r median_stp`.

## What is the average daily activity pattern?

getting the adequate data and plotting the results

```{r, dev='svg'}
activity %>% 
    group_by(interval) %>% 
    summarise(avg_stp = mean(steps, na.rm=T)) %>% 
    ggplot(aes(interval, avg_stp))+
    geom_line()+
    labs(title = "AVERAGE DAILY ACTIVITY", y="Steps", subtitle = "Average steps for each 5 minutes interval")
```

```{r}
activity %>% 
    group_by(interval) %>% 
    summarise(avg_stp = mean(steps, na.rm=T)) %>% 
    filter(avg_stp==max(avg_stp))


```

## Imputing missing values

Calculate the number of NA values in the data set

```{r}
casosna <- activity %>%
    mutate(complete = complete.cases(activity)) %>% 
    filter(complete == FALSE)
NAs <- nrow(casosna)
```

the database has a total of `r NAs` cases with NA Values

Replace the NA values with the mean for the respective interval

```{r, cache=TRUE}
Avg_Stp_DF <- activity %>% 
    group_by(interval) %>% 
    summarise(avg_stp = mean(steps, na.rm=T))
activityNARM <- activity
activityNARM$steps<-as.numeric(activityNARM$steps)
for(i in 1:nrow(activityNARM)){
    if(is.na(activityNARM[i,1])){
        x<-activityNARM[i,3]
        y<-filter(Avg_Stp_DF, interval==x$interval)
        activityNARM[i,1] <- y[1,2]
    }
}
```

Plotting the steps in a histogram

```{r, dev='svg'}
Total_stp_day <- activityNARM %>% 
    group_by(date) %>% 
    summarise(Steps = sum(steps))
ggplot(Total_stp_day, aes(Steps))+geom_histogram(fill="steelblue")+
    labs(x="average steps per day", y="Number of days",subtitle = "Number of days that the subject have walked a determined number of steps", title = "TOTAL STEPS PER DAY")
```

```{r}
total_stp_mean <- round(mean(Total_stp_day$Steps), 0)
total_stp_median <- round(median(Total_stp_day$Steps), 0)
```

The mean of the total steps per day is `r total_stp_mean` and the median is `r total_stp_median` steps.

## Are there differences in activity patterns between weekdays and weekends?

generate a variable indicating the weekday

```{r}
activityNARM <- activityNARM %>% 
    mutate(weekday = wday(date)) %>% 
    mutate(w_day_end = factor(weekday, levels = c(1:7), labels=c("weekday","weekday","weekday","weekday","weekday", "weekend", "weekend"))) %>% 
    select(-4)
```

Plotting the results

```{r, dev='svg'}
activityNARM %>% 
    group_by(interval, w_day_end) %>% 
    summarise(avg_stp_wd = mean(steps)) %>% 
    ggplot(aes(interval, avg_stp_wd))+
    geom_line(colour="coral")+
    facet_grid(w_day_end~.)+
    labs(title = "AVERAGE STEPS PER INTERVAL FOR WEEKDAYS AND WEEKENDS",
         y="Number Of steps", x="5min. interval",
         subtitle = "It seems the subject walk more steps on weekends \nwith a greater difference beetwen the intervals 1000-1500 ")


```
